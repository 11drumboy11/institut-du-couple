<!DOCTYPE html><html lang="fr"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire des Schémas de Young (YSQ-S3)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6da7;
            --secondary-color: #e9ecef;
            --accent-color: #3a5a8a;
            --text-color: #333;
            --light-text: #666;
            --very-light-bg: #f8f9fa;
            --light-bg: #e9ecef;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--very-light-bg);
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-weight: normal;
            font-size: 1.1rem;
        }
        
        main {
            padding: 20px;
        }
        
        .intro {
            background-color: var(--light-bg);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        h2 {
            color: var(--primary-color);
            margin: 25px 0 15px;
            border-bottom: 2px solid var(--light-bg);
            padding-bottom: 10px;
        }
        
        .legend {
            background-color: var(--secondary-color);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .legend h3 {
            margin-bottom: 10px;
            color: var(--accent-color);
        }
        
        .rating-guide {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .rating-item {
            text-align: center;
            flex: 1;
        }
        
        .rating-number {
            font-weight: bold;
            font-size: 1.2rem;
            display: block;
            color: var(--accent-color);
        }
        
        .questionnaire {
            margin-top: 20px;
        }
        
        .schema-section {
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 15px;
            background-color: white;
        }
        
        .schema-title {
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .question {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .question:last-child {
            border-bottom: none;
        }
        
        .question-text {
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .options {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .radio-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 16%;
        }
        
        input[type="radio"] {
            margin-top: 5px;
        }
        
        .progress-container {
            margin: 20px 0;
            background-color: var(--light-bg);
            border-radius: 5px;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--accent-color);
        }
        
        .btn-secondary {
            background-color: var(--light-bg);
            color: var(--text-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--border-color);
        }
        
        #results-container {
            display: none;
            padding: 20px;
        }
        
        .results-intro {
            margin-bottom: 30px;
        }
        
        .results-summary {
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--light-bg);
            border-radius: 5px;
        }
        
        .schema-description {
            margin-top: 10px;
            font-style: italic;
            color: var(--light-text);
        }
        
        .chart-container {
            margin: 30px 0;
            height: 400px;
        }
        
        .schema-detail {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 5px;
            border-left: 5px solid var(--primary-color);
            background-color: var(--very-light-bg);
        }
        
        .schema-score {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .schema-interpretation {
            margin-top: 10px;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .level-indicator {
            display: flex;
            margin-top: 10px;
        }
        
        .level {
            flex: 1;
            text-align: center;
            padding: 5px;
            font-size: 0.8rem;
        }
        
        .level.low {
            background-color: #e9ecef;
        }
        
        .level.medium {
            background-color: #adb5bd;
        }
        
        .level.high {
            background-color: #6c757d;
            color: white;
        }
        
        .level.very-high {
            background-color: #343a40;
            color: white;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .options {
                flex-wrap: wrap;
            }
            
            .radio-option {
                width: 33%;
                margin-bottom: 10px;
            }
            
            .rating-guide {
                flex-wrap: wrap;
            }
            
            .rating-item {
                width: 33%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Questionnaire des Schémas de Young (YSQ-S3)</h1>
            <p class="subtitle">Évaluation des schémas précoces inadaptés</p>
        </header>
        
        <main id="questionnaire-container">
            <div class="intro">
                <p>Ce questionnaire permet d'identifier les schémas précoces inadaptés selon la théorie de Jeffrey Young. Veuillez répondre à chaque question en fonction de ce que vous ressentez ou avez ressenti au cours de votre vie.</p>
                <p>Il n'y a pas de bonnes ou mauvaises réponses. Vos réponses sont confidentielles et serviront uniquement à mieux comprendre vos schémas et à orienter le travail thérapeutique.</p>
            </div>
            
            <div class="legend">
                <h3>Comment répondre</h3>
                <p>Pour chaque énoncé, choisissez le chiffre qui décrit le mieux ce que vous pensez ou ressentez :</p>
                <div class="rating-guide">
                    <div class="rating-item">
                        <span class="rating-number">1</span>
                        <span>Complètement faux</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-number">2</span>
                        <span>Le plus souvent faux</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-number">3</span>
                        <span>Plutôt vrai que faux</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-number">4</span>
                        <span>Modérément vrai</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-number">5</span>
                        <span>Le plus souvent vrai</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-number">6</span>
                        <span>Me décrit parfaitement</span>
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar" style="width: 0%">0%</div>
            </div>
            
            <div id="questionnaire" class="questionnaire">
                <!-- Le contenu du questionnaire sera généré dynamiquement ici -->
            </div>
            
            <div class="nav-buttons">
                <button id="prev-btn" class="btn-secondary" disabled="">Précédent</button>
                <button id="next-btn" class="btn-primary">Suivant</button>
            </div>
        </main>
        
        <div id="results-container">
            <div class="results-intro">
                <h2>Résultats de l'évaluation des schémas</h2>
                <p>Voici l'analyse de vos réponses au questionnaire des schémas de Young (YSQ-S3). Ces résultats indiquent l'intensité relative de chacun des 18 schémas précoces inadaptés.</p>
            </div>
            
            <div class="results-summary">
                <h3>Synthèse des résultats</h3>
                <p id="summary-text"></p>
            </div>
            
            <div class="chart-container">
                <canvas id="results-chart"></canvas>
            </div>
            
            <h3>Analyse détaillée par schéma</h3>
            <div id="detailed-results">
                <!-- Les résultats détaillés seront générés dynamiquement ici -->
            </div>
            
            <div class="actions">
                <button id="print-btn" class="btn-secondary">Imprimer</button>
                <button id="pdf-btn" class="btn-primary">Exporter en PDF</button>
                <button id="restart-btn" class="btn-secondary">Recommencer</button>
            </div>
        </div>
    </div>
    
    <script>
        // Définition des schémas et de leurs questions
        const schemas = [
            {
                id: "abandonment",
                name: "Abandon / Instabilité",
                description: "La perception que les personnes significatives ne pourront pas continuer à fournir le soutien émotionnel, la connexion, la force ou la protection dont on a besoin parce qu'elles sont émotionnellement instables, imprévisibles, peu fiables, ou qu'elles mourront ou vous abandonneront.",
                questions: [
                    "J'ai peur que les personnes auxquelles je tiens me quittent ou m'abandonnent.",
                    "Je m'accroche aux personnes proches de moi car j'ai peur qu'elles me quittent.",
                    "J'ai peur que les personnes auxquelles je tiens me laissent ou m'abandonnent.",
                    "Je sens que les gens vont profiter de moi.",
                    "J'ai le sentiment que je ne peux pas baisser la garde en présence des autres, sinon ils me blesseront délibérément."
                ]
            },
            {
                id: "mistrust",
                name: "Méfiance / Abus",
                description: "L'attente que les autres vont me blesser, abuser de moi, m'humilier, me tromper, mentir, manipuler ou profiter de moi.",
                questions: [
                    "J'ai la plus grande difficulté à faire confiance aux autres.",
                    "Je suis très méfiant quant aux motivations des autres.",
                    "Les autres sont rarement honnêtes, ils ne sont pas en général ce qu'ils paraissent.",
                    "Je pense habituellement aux véritables intentions des autres.",
                    "Si je pense que quelqu'un cherche à me blesser, je lui fais prouver le contraire avant que je lui fasse confiance."
                ]
            },
            {
                id: "emotional_deprivation",
                name: "Carence affective",
                description: "L'attente que mon désir normal de soutien émotionnel ne sera pas adéquatement satisfait par les autres.",
                questions: [
                    "La plupart du temps, personne n'a été là pour me soutenir, m'écouter, m'encourager ou être sensible à mes besoins réels.",
                    "En général, je n'ai pas eu quelqu'un pour me prodiguer soins et attention.",
                    "Je n'ai pas eu l'impression d'être spécial pour quelqu'un.",
                    "Généralement, je n'ai pas eu quelqu'un pour vraiment m'écouter, me comprendre ou être sensible à mes besoins et sentiments.",
                    "J'ai rarement eu une personne forte pour me donner de bons conseils ou me guider quand je n'étais pas sûr de ce qu'il fallait faire."
                ]
            },
            {
                id: "defectiveness",
                name: "Imperfection / Honte",
                description: "Le sentiment que je suis défectueux, mauvais, indésirable, inférieur, ou sans valeur dans les domaines importants; ou que je ne serais pas aimable pour les autres.",
                questions: [
                    "Je ne me sens pas digne d'amour, d'attention et de respect des autres.",
                    "Je me sens indésirable.",
                    "Je me sens trop imparfait pour me révéler aux autres.",
                    "Aucune personne que je désire ne voudrait rester proche de moi si elle me connaissait réellement.",
                    "Je suis fondamentalement défectueux par rapport aux autres."
                ]
            },
            {
                id: "social_isolation",
                name: "Isolement social",
                description: "Le sentiment que je suis isolé du reste du monde, différent des autres, et/ou pas faisant partie d'un groupe.",
                questions: [
                    "Je ne m'intègre pas vraiment dans un groupe.",
                    "Je suis fondamentalement différent des autres.",
                    "Je ne me sens pas appartenir à un groupe; je suis solitaire.",
                    "Je me sens étranger aux autres.",
                    "Je me sens isolé et seul."
                ]
            },
            {
                id: "dependence",
                name: "Dépendance / Incompétence",
                description: "La croyance que je suis incapable de faire face à mes responsabilités quotidiennes sans l'aide des autres.",
                questions: [
                    "Je ne me sens pas capable de me débrouiller par moi-même dans la vie quotidienne.",
                    "J'ai besoin des autres pour m'aider à résoudre mes problèmes.",
                    "Je me considère comme une personne dépendante.",
                    "Je n'ai pas confiance dans ma capacité à résoudre les problèmes quotidiens.",
                    "Je me sens comme un enfant - quand je suis laissé à moi-même dans la vie quotidienne."
                ]
            },
            {
                id: "vulnerability",
                name: "Vulnérabilité",
                description: "La peur exagérée qu'une catastrophe imminente se produira à tout moment et que je serai incapable de l'empêcher.",
                questions: [
                    "Je ne peux pas m'empêcher de penser que quelque chose de mauvais va arriver.",
                    "J'ai le sentiment qu'une catastrophe (naturelle, criminelle, financière ou médicale) pourrait survenir à tout moment.",
                    "J'ai peur d'être attaqué.",
                    "J'ai peur de perdre tout mon argent et devenir démuni.",
                    "J'ai peur d'attraper une maladie grave, même s'il n'y a pas de raison médicale qui justifie cette crainte."
                ]
            },
            {
                id: "enmeshment",
                name: "Fusion / Personnalité atrophiée",
                description: "Une implication émotionnelle et une proximité excessives avec une ou plusieurs personnes significatives aux dépens d'une individualisation normale.",
                questions: [
                    "Je n'ai pas réussi à me séparer de mes parents comme semblent l'avoir fait les autres personnes de mon âge.",
                    "Mes parents et moi avons tendance à nous impliquer excessivement dans la vie et les problèmes des uns et des autres.",
                    "Il est très difficile pour mes parents et moi de garder pour nous des détails intimes sans nous sentir trahis ou coupables.",
                    "Je partage souvent trop d'informations personnelles avec les autres.",
                    "Je ressens souvent que je n'ai pas une identité séparée de celle de mes parents ou de mon(ma) partenaire."
                ]
            },
            {
                id: "failure",
                name: "Échec",
                description: "La croyance que j'ai échoué, que j'échouerai inévitablement, ou que je suis fondamentalement inadéquat par rapport à mes pairs.",
                questions: [
                    "Je ne suis pas aussi talentueux au travail que la plupart des gens.",
                    "Je ne suis pas aussi intelligent que la plupart des gens concernant le travail ou les études.",
                    "La plupart des gens sont plus capables que moi dans les domaines du travail et de la réussite.",
                    "Je suis un raté.",
                    "Je ne suis pas aussi doué que la plupart des gens dans leur travail."
                ]
            },
            {
                id: "entitlement",
                name: "Droits personnels exagérés / Grandeur",
                description: "La croyance que je suis supérieur aux autres, que j'ai droit à des privilèges spéciaux, ou que je ne suis pas tenu par les règles qui régissent les interactions sociales normales.",
                questions: [
                    "J'ai beaucoup de difficulté à accepter non comme réponse quand je veux quelque chose des autres.",
                    "Je suis souvent irrité ou en colère quand je ne peux pas obtenir ce que je veux.",
                    "Je déteste être contraint ou empêché de faire ce que je veux.",
                    "Je pense que je devrais pouvoir faire ce que je veux sans être limité par des restrictions qui s'appliquent aux autres.",
                    "Je déteste accepter des limites."
                ]
            },
            {
                id: "insufficient_self_control",
                name: "Contrôle de soi / Autodiscipline insuffisants",
                description: "Difficulté persistante ou refus d'exercer un contrôle de soi suffisant et de tolérer la frustration pour atteindre ses objectifs personnels.",
                questions: [
                    "Je ne parviens pas à me discipliner pour accomplir des tâches routinières ou ennuyeuses.",
                    "Si je ne peux pas atteindre un objectif, je deviens facilement frustré et j'abandonne.",
                    "J'ai beaucoup de difficulté à sacrifier une gratification immédiate pour atteindre un objectif à long terme.",
                    "Je ne peux pas me forcer à faire des choses que je n'aime pas, même si je sais que c'est pour mon bien.",
                    "J'ai rarement été capable de maintenir mes résolutions."
                ]
            },
            {
                id: "subjugation",
                name: "Assujettissement",
                description: "Se soumettre excessivement au contrôle des autres pour éviter la colère, les représailles ou l'abandon.",
                questions: [
                    "Je laisse les autres faire ce qu'ils veulent car j'ai peur des conséquences.",
                    "Je trouve que si je fais ce que je veux, je ne fais que chercher les problèmes.",
                    "Je sens que je n'ai pas d'autre choix que de céder aux souhaits des autres, sinon ils me rejetteront ou riposteront d'une façon ou d'une autre.",
                    "Dans les relations, je laisse l'autre avoir le contrôle.",
                    "J'ai toujours laissé les autres choisir pour moi, de sorte que je ne sais pas vraiment ce que je veux moi-même."
                ]
            },
            {
                id: "self_sacrifice",
                name: "Abnégation",
                description: "Se concentrer excessivement sur la satisfaction des besoins des autres, au détriment de sa propre gratification.",
                questions: [
                    "Je suis celui qui finit habituellement par prendre soin des personnes qui me sont proches.",
                    "Je suis une bonne personne car je pense aux autres plus qu'à moi-même.",
                    "Je suis tellement occupé à faire des choses pour les personnes dont je me soucie que j'ai peu de temps pour moi.",
                    "J'ai toujours été celui qui écoute les problèmes de tout le monde.",
                    "Les autres me voient comme faisant trop pour les autres et pas assez pour moi-même."
                ]
            },
            {
                id: "approval_seeking",
                name: "Recherche d'approbation et de reconnaissance",
                description: "L'accent excessif mis sur l'obtention de l'approbation, de la reconnaissance ou de l'attention des autres.",
                questions: [
                    "Lorsque quelqu'un me montre de l'affection, j'ai du mal à y croire.",
                    "Je me sens plus à l'aise lorsque je passe inaperçu dans un groupe.",
                    "Je ne demande pas souvent de l'aide car je crains de déranger les autres.",
                    "Je me retiens souvent d'exprimer mes sentiments de peur d'être critiqué ou rejeté.",
                    "J'ai l'impression de devoir être parfait pour être accepté par les autres."
                ]
            },
            {
                id: "negativity",
                name: "Négativité / Pessimisme",
                description: "Une focalisation omniprésente sur les aspects négatifs de la vie tout en minimisant les aspects positifs ou optimistes.",
                questions: [
                    "Même quand les choses semblent bien se passer, je sens que ce n'est que temporaire.",
                    "Si quelque chose de bien arrive, je m'inquiète : quelque chose de mauvais va probablement suivre.",
                    "On ne peut pas être trop prudent, les choses tournent presque toujours mal.",
                    "J'ai tendance à me concentrer sur les aspects négatifs des situations.",
                    "J'ai tendance à m'attendre au pire des scénarios."
                ]
            },
            {
                id: "emotional_inhibition",
                name: "Inhibition émotionnelle",
                description: "L'inhibition excessive des actions, des sentiments ou de la communication spontanés pour éviter la désapprobation, la honte ou la perte de contrôle.",
                questions: [
                    "Je dois être le meilleur dans ce que je fais; je ne peux pas accepter d'être le second.",
                    "J'essaie de faire de mon mieux; je ne peux pas me contenter de 'suffisamment bien'.",
                    "Je dois faire face à toutes mes responsabilités.",
                    "Je ressens de la pression constante pour réussir et accomplir des choses.",
                    "Ma santé a souffert parce que je me suis mis trop de pression pour bien faire les choses."
                ]
            },
            {
                id: "unrelenting_standards",
                name: "Exigences élevées / Critique excessive",
                description: "La croyance que je dois atteindre des standards internes très élevés de comportement et de performance, généralement pour éviter la critique.",
                questions: [
                    "J'essaie de faire de mon mieux la plupart du temps; je ne peux pas accepter juste 'assez bon'.",
                    "Je dois respecter toutes mes obligations.",
                    "Je ressens une pression constante pour accomplir et atteindre mes objectifs.",
                    "Je ne me permets pas facilement d'excuses pour mes erreurs ou insuffisances.",
                    "J'ai tellement de choses à accomplir que j'ai à peine le temps de me détendre."
                ]
            },
            {
                id: "punitiveness",
                name: "Punition",
                description: "La croyance que les personnes devraient être sévèrement punies pour leurs erreurs.",
                questions: [
                    "Quand je fais une erreur, je mérite d'être puni.",
                    "Si je fais une erreur, je devrais en subir les conséquences.",
                    "Face aux erreurs, je suis plus critique envers moi-même qu'envers les autres.",
                    "Je suis implacable envers moi-même lorsque je commets des erreurs.",
                    "Je ne pardonne pas facilement mes erreurs."
                ]
            }
        ];
        
        // Variables globales
        let currentSchemaIndex = 0;
        let currentQuestionIndex = 0;
        let answers = {}; // Pour stocker les réponses
        
        // Initialiser le questionnaire
        function initQuestionnaire() {
            renderCurrentSchema();
            updateProgressBar();
        }
        
        // Rendu du schéma actuel
        function renderCurrentSchema() {
            const schema = schemas[currentSchemaIndex];
            const questionnaire = document.getElementById('questionnaire');
            questionnaire.innerHTML = '';
            
            const schemaSection = document.createElement('div');
            schemaSection.className = 'schema-section';
            
            const schemaTitle = document.createElement('div');
            schemaTitle.className = 'schema-title';
            schemaTitle.textContent = schema.name;
            schemaSection.appendChild(schemaTitle);
            
            const question = schema.questions[currentQuestionIndex];
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = `${currentSchemaIndex * 5 + currentQuestionIndex + 1}. ${question}`;
            questionDiv.appendChild(questionText);
            
            const options = document.createElement('div');
            options.className = 'options';
            
            for (let i = 1; i <= 6; i++) {
                const radioOption = document.createElement('div');
                radioOption.className = 'radio-option';
                
                const span = document.createElement('span');
                span.textContent = i;
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `q_${currentSchemaIndex}_${currentQuestionIndex}`;
                input.value = i;
                input.required = true;
                
                // Vérifier si une réponse existe déjà pour cette question
                const answerKey = `${currentSchemaIndex}_${currentQuestionIndex}`;
                if (answers[answerKey]) {
                    input.checked = (answers[answerKey] == i);
                }
                
                input.addEventListener('change', function() {
                    answers[answerKey] = i;
                });
                
                radioOption.appendChild(span);
                radioOption.appendChild(input);
                options.appendChild(radioOption);
            }
            
            questionDiv.appendChild(options);
            schemaSection.appendChild(questionDiv);
            questionnaire.appendChild(schemaSection);
            
            // Mise à jour des boutons
            document.getElementById('prev-btn').disabled = (currentSchemaIndex === 0 && currentQuestionIndex === 0);
            
            const isLastQuestion = (currentSchemaIndex === schemas.length - 1 && currentQuestionIndex === schema.questions.length - 1);
            const nextBtn = document.getElementById('next-btn');
            nextBtn.textContent = isLastQuestion ? 'Voir les résultats' : 'Suivant';
        }
        
        // Mise à jour de la barre de progression
        function updateProgressBar() {
            const totalQuestions = schemas.length * 5; // 5 questions par schéma
            const answeredQuestions = Object.keys(answers).length;
            const progress = (answeredQuestions / totalQuestions) * 100;
            
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = `${progress}%`;
            progressBar.textContent = `${Math.round(progress)}%`;
        }
        
        // Gestion du bouton précédent
        document.getElementById('prev-btn').addEventListener('click', function() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
            } else if (currentSchemaIndex > 0) {
                currentSchemaIndex--;
                currentQuestionIndex = schemas[currentSchemaIndex].questions.length - 1;
            }
            renderCurrentSchema();
        });
        
        // Gestion du bouton suivant
        document.getElementById('next-btn').addEventListener('click', function() {
            const answerKey = `${currentSchemaIndex}_${currentQuestionIndex}`;
            if (!answers[answerKey]) {
                alert('Veuillez sélectionner une réponse avant de continuer.');
                return;
            }
            
            const currentSchema = schemas[currentSchemaIndex];
            
            if (currentQuestionIndex < currentSchema.questions.length - 1) {
                currentQuestionIndex++;
            } else if (currentSchemaIndex < schemas.length - 1) {
                currentSchemaIndex++;
                currentQuestionIndex = 0;
            } else {
                // Questionnaire terminé, afficher les résultats
                showResults();
                return;
            }
            
            renderCurrentSchema();
            updateProgressBar();
        });
        
        // Calcul des scores et affichage des résultats
        function showResults() {
            // Calculer les scores par schéma
            const scores = {};
            
            schemas.forEach((schema, schemaIndex) => {
                let total = 0;
                let count = 0;
                
                schema.questions.forEach((_, questionIndex) => {
                    const answerKey = `${schemaIndex}_${questionIndex}`;
                    if (answers[answerKey]) {
                        total += parseInt(answers[answerKey]);
                        count++;
                    }
                });
                
                // Calculer le score moyen et le pourcentage
                const average = count > 0 ? total / count : 0;
                const percentage = (average / 6) * 100; // 6 est le maximum sur l'échelle
                
                scores[schema.id] = {
                    raw: total,
                    average: average,
                    percentage: percentage
                };
            });
            
            // Trier les schémas par score décroissant
            const sortedSchemas = [...schemas].sort((a, b) => {
                return scores[b.id].percentage - scores[a.id].percentage;
            });
            
            // Créer le résumé
            const topSchemas = sortedSchemas.slice(0, 3);
            
            let summaryText = "D'après vos réponses, les schémas les plus actifs chez vous sont : ";
            topSchemas.forEach((schema, index) => {
                summaryText += `<strong>${schema.name}</strong> (${Math.round(scores[schema.id].percentage)}%)`;
                if (index < topSchemas.length - 1) {
                    summaryText += index === topSchemas.length - 2 ? ' et ' : ', ';
                }
            });
            summaryText += ". Ces schémas pourraient influencer votre manière de percevoir les situations et d'interagir avec les autres.";
            
            document.getElementById('summary-text').innerHTML = summaryText;
            
            // Créer le graphique
            createChart(scores);
            
            // Générer les résultats détaillés
            generateDetailedResults(scores, sortedSchemas);
            
            // Afficher les résultats
            document.getElementById('questionnaire-container').style.display = 'none';
            document.getElementById('results-container').style.display = 'block';
        }
        
        // Création du graphique
        function createChart(scores) {
            const ctx = document.getElementById('results-chart').getContext('2d');
            
            // Données pour le graphique
            const labels = schemas.map(schema => schema.name);
            const data = schemas.map(schema => Math.round(scores[schema.id].percentage));
            
            // Ligne de normalité (50%)
            const normalLine = Array(schemas.length).fill(50);
            
            // Couleurs en fonction du score
            const backgroundColors = data.map(value => {
                if (value < 40) return 'rgba(75, 192, 192, 0.6)'; // Faible - vert
                if (value < 60) return 'rgba(255, 206, 86, 0.6)'; // Modéré - jaune
                if (value < 80) return 'rgba(255, 159, 64, 0.6)'; // Élevé - orange
                return 'rgba(255, 99, 132, 0.6)'; // Très élevé - rouge
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Score (%)',
                            data: data,
                            backgroundColor: backgroundColors,
                            borderColor: backgroundColors.map(color => color.replace('0.6', '1')),
                            borderWidth: 1
                        },
                        {
                            label: 'Seuil de significativité',
                            data: normalLine,
                            type: 'line',
                            fill: false,
                            borderColor: 'rgba(54, 162, 235, 0.8)',
                            borderWidth: 2,
                            pointRadius: 0,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Pourcentage'
                            }
                        },
                        x: {
                            ticks: {
                                autoSkip: false,
                                maxRotation: 90,
                                minRotation: 90
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Score: ${context.raw}%`;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }
        
        // Génération des résultats détaillés
        function generateDetailedResults(scores, sortedSchemas) {
            const detailedResults = document.getElementById('detailed-results');
            detailedResults.innerHTML = '';
            
            sortedSchemas.forEach(schema => {
                const percentage = Math.round(scores[schema.id].percentage);
                
                const schemaDetail = document.createElement('div');
                schemaDetail.className = 'schema-detail';
                
                // Utiliser une couleur de bordure différente en fonction du score
                if (percentage < 40) {
                    schemaDetail.style.borderLeftColor = '#4bc0c0'; // Faible
                } else if (percentage < 60) {
                    schemaDetail.style.borderLeftColor = '#ffce56'; // Modéré
                } else if (percentage < 80) {
                    schemaDetail.style.borderLeftColor = '#ff9f40'; // Élevé
                } else {
                    schemaDetail.style.borderLeftColor = '#ff6384'; // Très élevé
                }
                
                const schemaName = document.createElement('h4');
                schemaName.textContent = schema.name;
                
                const schemaScore = document.createElement('div');
                schemaScore.className = 'schema-score';
                schemaScore.textContent = `Score : ${percentage}%`;
                
                const schemaDescription = document.createElement('div');
                schemaDescription.className = 'schema-description';
                schemaDescription.textContent = schema.description;
                
                const schemaInterpretation = document.createElement('div');
                schemaInterpretation.className = 'schema-interpretation';
                
                let interpretationText = '';
                if (percentage < 40) {
                    interpretationText = 'Ce schéma est peu actif pour vous.';
                } else if (percentage < 60) {
                    interpretationText = 'Ce schéma est modérément actif et peut influencer certains aspects de votre vie.';
                } else if (percentage < 80) {
                    interpretationText = 'Ce schéma est significativement actif et influence probablement plusieurs aspects de votre vie.';
                } else {
                    interpretationText = 'Ce schéma est très actif et a probablement une influence majeure sur votre façon de penser, de ressentir et d\'agir.';
                }
                
                schemaInterpretation.textContent = interpretationText;
                
                const levelIndicator = document.createElement('div');
                levelIndicator.className = 'level-indicator';
                
                const levels = [
                    { class: 'low', text: 'Faible' },
                    { class: 'medium', text: 'Modéré' },
                    { class: 'high', text: 'Élevé' },
                    { class: 'very-high', text: 'Très élevé' }
                ];
                
                levels.forEach(level => {
                    const levelDiv = document.createElement('div');
                    levelDiv.className = `level ${level.class}`;
                    levelDiv.textContent = level.text;
                    levelIndicator.appendChild(levelDiv);
                });
                
                schemaDetail.appendChild(schemaName);
                schemaDetail.appendChild(schemaScore);
                schemaDetail.appendChild(schemaDescription);
                schemaDetail.appendChild(schemaInterpretation);
                schemaDetail.appendChild(levelIndicator);
                
                detailedResults.appendChild(schemaDetail);
            });
        }
        
        // Fonction pour imprimer les résultats
        document.getElementById('print-btn').addEventListener('click', function() {
            window.print();
        });
        
        // Fonction pour exporter en PDF
        document.getElementById('pdf-btn').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Titre
            doc.setFontSize(18);
            doc.text('Résultats du Questionnaire des Schémas de Young (YSQ-S3)', 15, 20);
            
            doc.setFontSize(12);
            doc.text('Date : ' + new Date().toLocaleDateString(), 15, 30);
            
            // Résultats
            doc.setFontSize(14);
            doc.text('Scores des schémas (en pourcentage)', 15, 40);
            
            let y = 50;
            
            // Trier les schémas par score décroissant pour le PDF
            const sortedSchemas = [...schemas].sort((a, b) => {
                const scoresA = calculateSchemaScore(a);
                const scoresB = calculateSchemaScore(b);
                return scoresB.percentage - scoresA.percentage;
            });
            
            sortedSchemas.forEach(schema => {
                const scores = calculateSchemaScore(schema);
                doc.setFontSize(12);
                doc.text(`${schema.name}: ${Math.round(scores.percentage)}%`, 20, y);
                y += 8;
                
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
            });
            
            // Sauvegarder le PDF
            doc.save('resultats-schemas-young.pdf');
        });
        
        // Fonction pour calculer le score d'un schéma
        function calculateSchemaScore(schema) {
            const schemaIndex = schemas.indexOf(schema);
            let total = 0;
            let count = 0;
            
            schema.questions.forEach((_, questionIndex) => {
                const answerKey = `${schemaIndex}_${questionIndex}`;
                if (answers[answerKey]) {
                    total += parseInt(answers[answerKey]);
                    count++;
                }
            });
            
            const average = count > 0 ? total / count : 0;
            const percentage = (average / 6) * 100;
            
            return {
                raw: total,
                average: average,
                percentage: percentage
            };
        }
        
        // Fonction pour recommencer le questionnaire
        document.getElementById('restart-btn').addEventListener('click', function() {
            // Réinitialiser les variables
            currentSchemaIndex = 0;
            currentQuestionIndex = 0;
            answers = {};
            
            // Afficher à nouveau le questionnaire
            document.getElementById('questionnaire-container').style.display = 'block';
            document.getElementById('results-container').style.display = 'none';
            
            // Réinitialiser le questionnaire
            initQuestionnaire();
        });
        
        // Initialiser le questionnaire au chargement
        document.addEventListener('DOMContentLoaded', initQuestionnaire);
    </script>


</body></html>